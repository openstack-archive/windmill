- job:
    name: windmill-buildimages
    parent: legacy-base
    run: tests/legacy/windmill-buildimages/run.yaml
    timeout: 3600
    required-projects:
      - openstack/windmill

- job:
    name: windmill-base
    run: tests/tox/run.yaml
    timeout: 3600
    required-projects:
      - openstack/windmill
    vars:
      tox_envlist: deploy

- job:
    name: windmill-new
    run:
      - playbooks/bootstrap.yaml
      - playbooks/zookeeper.yaml
      - playbooks/nodepool-builder.yaml
      - playbooks/nodepool-launcher.yaml
      - playbooks/zuul-executor.yaml
      - playbooks/zuul-merger.yaml
      - playbooks/zuul-scheduler.yaml
#    post-run: playbooks/prove.yaml
    timeout: 3600
    roles:
      - zuul: openstack/ansible-role-diskimage-builder
        name: openstack.diskimage-builder
      - zuul: openstack/ansible-role-logrotate
        name: openstack.logrotate
      - zuul: openstack/ansible-role-nodepool
        name: openstack.nodepool
      - zuul: openstack/ansible-role-shade
        name: openstack.shade
      - zuul: openstack/ansible-role-ssh
        name: openstack.ssh
      - zuul: openstack/ansible-role-sudoers
        name: openstack.sudoers
      - zuul: openstack/ansible-role-virtualenv
        name: openstack.virtualenv
      - zuul: openstack/ansible-role-zookeeper
        name: openstack.zookeeper
      - zuul: openstack/ansible-role-zuul
        name: openstack.zuul
    nodeset:
      nodes:
        - name: ubuntu-xenial
          label: ubuntu-xenial
      groups:
        - name: bastion
          nodes:
            - ubuntu-xenial
        - name: nodepool-builder
          nodes:
            - ubuntu-xenial
        - name: nodepool-launcher
          nodes:
            - ubuntu-xenial
        - name: zookeeper
          nodes:
            - ubuntu-xenial
        - name: zuul-executor
          nodes:
            - ubuntu-xenial
        - name: zuul-merger
          nodes:
            - ubuntu-xenial
        - name: zuul-scheduler
          nodes:
            - ubuntu-xenial

- job:
    name: windmill-centos-7
    parent: windmill-base
    nodeset: centos-7

- job:
    name: windmill-fedora-26
    parent: windmill-base
    nodeset: fedora-26

- job:
    name: windmill-ubuntu-xenial
    parent: windmill-base
    nodeset: ubuntu-xenial
